(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["page-absen-group_selfie"],{"0538":function(e,t,n){"use strict";var a=n("1c0b"),i=n("861d"),s=[].slice,r={},o=function(e,t,n){if(!(t in r)){for(var a=[],i=0;i<t;i++)a[i]="a["+i+"]";r[t]=Function("C,a","return new C("+a.join(",")+")")}return r[t](e,n)};e.exports=Function.bind||function(e){var t=a(this),n=s.call(arguments,1),r=function(){var a=n.concat(s.call(arguments));return this instanceof r?o(t,a.length,a):t.apply(e,a)};return i(t.prototype)&&(r.prototype=t.prototype),r}},"07ac":function(e,t,n){var a=n("23e7"),i=n("6f53").values;a({target:"Object",stat:!0},{values:function(e){return i(e)}})},"0d03":function(e,t,n){var a=n("6eeb"),i=Date.prototype,s="Invalid Date",r="toString",o=i[r],c=i.getTime;new Date(NaN)+""!=s&&a(i,r,(function(){var e=c.call(this);return e===e?o.call(this):s}))},"31c1":function(e,t,n){"use strict";n("c60f")},"6f53":function(e,t,n){var a=n("83ab"),i=n("df75"),s=n("fc6a"),r=n("d1e7").f,o=function(e){return function(t){var n,o=s(t),c=i(o),l=c.length,d=0,u=[];while(l>d)n=c[d++],a&&!r.call(o,n)||u.push(e?[n,o[n]]:o[n]);return u}};e.exports={entries:o(!0),values:o(!1)}},a49e:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"py-4 px-2 shadow bg-blue-light text-white font-bold"},[n("p",{staticClass:"mt-1 font-semibold text-xs float-right mr-3"},[e._v(" Face Recognition ")]),n("div",{staticClass:"ml-2 cursor-pointer",on:{click:function(t){return e.$router.go(-1)}}},[n("svg",{staticClass:"d-inline mr-1",staticStyle:{fill:"white"},attrs:{width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"}},[n("path",{attrs:{d:"M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"}})])])]),n("div",{staticClass:"row"},[e.streamOn?n("div",{staticClass:"col-sm-12 text-center"},[n("video",{attrs:{id:"videoQRCODE",autoplay:"",muted:""},domProps:{muted:!0}}),n("div",{staticClass:"text-center rounded-t-lg shadow background_gps p-3"},[n("div",{staticStyle:{height:"70px"}},[n("div",{staticClass:"row justify-content-center"},[n("div",{staticClass:"col-9"},[n("div",{staticClass:"text-center"},[n("button",{staticClass:"p-3 mt-2 btn btn-sm btn-warning rounded-lg font-semibold btn-block text-sm",attrs:{type:"submit"},on:{click:e.startScan}},[n("svg",{staticClass:"d-inline mr-2",staticStyle:{fill:"black"},attrs:{width:"17",height:"17",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[n("path",{attrs:{d:"M220.6 121.2L271.1 96 448 96v96H333.2c-21.9-15.1-48.5-24-77.2-24s-55.2 8.9-77.2 24H64V128H192c9.9 0 19.7-2.3 28.6-6.8zM0 128V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H271.1c-9.9 0-19.7 2.3-28.6 6.8L192 64H160V48c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16l0 16C28.7 64 0 92.7 0 128zM168 304a88 88 0 1 1 176 0 88 88 0 1 1 -176 0z"}})]),e._v(" Take Picture ")])])])]),n("p",{staticClass:"text-xs font-semibold text-white"},[e._v(" Remove Mask and any other accessories before take a selfie ! ")])]),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{staticClass:"text-xs p-3 font-semibold"},[""!=e.message?n("p",[e._v(e._s(e.message))]):e._e()]),n("canvas",{staticClass:"d-none",staticStyle:{overflow:"auto"},attrs:{id:"canvas"}})]):n("div",{staticClass:"col-sm-12",staticStyle:{height:"100vh"},on:{click:function(t){e.getStream("video"),e.streamOn=!0,e.$forceUpdate()}}},[e._m(0)])])])},i=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"d-flex justify-content-center align-items-center shadow-lg rounded-lg",staticStyle:{height:"90vh"}},[n("div",{staticStyle:{width:"100%"}},[n("p",{staticClass:"text-center text-xl font-semibold"},[e._v(" Klik disini untuk Start Camera! ")])])])}],s=n("1da1"),r=(n("96cf"),n("4160"),n("159b"),n("b0c0"),n("d3b7"),n("3ca3"),n("ddb0"),n("d81d"),n("cfc3"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("ace4"),n("07ac"),n("e25e"),n("0d03"),n("4795"),n("2b3d"),n("c0b6"),n("bc3a"),n("2f0b")),o=n("75bf"),c=new r["a"]("ci"),l={data:function(){return{isIos:!1,countIos:0,streamOn:!1,expressions:null,listUsers:[],urutanEkspresi:[],message:"",listExpressions:[]}},methods:{startScan:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n,a,i,r,l,d,u,h,g,f,m,v;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.message="",n=document.getElementById("videoQRCODE"),a=t,e.next=6,o["createCanvasFromMedia"](n);case 6:return i=e.sent,i.style.position="absolute;",r={width:i.width,height:i.height},console.log(r),o["euclideanDistance"]([0,0],[0,20]),o["matchDimensions"](i,r),l=null,e.next=15,o["detectAllFaces"](n).withFaceLandmarks().withFaceDescriptors();case 15:return l=e.sent,console.log("change",l[0].landmarks.getMouth()),d=l[0].landmarks.getMouth(),console.log("mulut",d),console.log(l),u=o["resizeResults"](l,r),console.log(i.width,i.height),i.getContext("2d").clearRect(0,0,i.width,i.height),o["draw"].drawDetections(i,u),o["draw"].drawFaceLandmarks(i,u),h=[],a.$store.state.employees.forEach((function(e){h.push({hit_id:e.hit_id,name:e.name,work_location_id:e.work_location_id,facejson:JSON.parse(e.faces)})})),e.next=29,Promise.all(h.map(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.facejson){e.next=4;break}return n=[],t.facejson.forEach((function(e){n.push(new Float32Array(Object.values(e[0])))})),e.abrupt("return",new o["LabeledFaceDescriptors"](JSON.stringify({hit_id:t.hit_id,name:t.name,work_location_id:t.work_location_id,_id:t.hit_id}),n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 29:if(g=e.sent,f=parseInt(a.$store.state.akurasiWajah)/100,m=new o["FaceMatcher"](g,f),v=l.map((function(e){return m.findBestMatch(e.descriptor)})),!(v.length>0)){e.next=41;break}if("unknown"!=v[0]._label){e.next=37;break}return c.alert("Wajah Tidak ditemukan","bg-black"),e.abrupt("return",!1);case 37:document.querySelectorAll("canvas").forEach((function(e,t){t>0&&e.remove()})),v.forEach(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,n){var s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log(t),s=JSON.parse(t.label),r=JSON.parse(t._distance),console.log(r),a.faceid=s,100-100*r>60?(c.alert("Wajah ditemukan!","bg-green-400"),a.loading=!1,console.log("hasil",s),a.cekExpressionAbsen(s,i)):c.alert("Persentase hanya ".concat(100-100*r),"bg-green-400");case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=43;break;case 41:a.loading=!1,c.alert("Data tidak ada atau tidak ditemukan di gang ini!");case 43:e.next=49;break;case 45:e.prev=45,e.t0=e["catch"](0),console.log("error"),c.alert(e.t0);case 49:case"end":return e.stop()}}),e,null,[[0,45]])})))()},cekExpressionAbsen:function(e,t){var n=this;if(0==this.listExpressions.length&&(this.listExpressions[0]=this.expressions),0==this.listUsers.length?this.listUsers[0]=e.hit_id:this.listUsers[1]=e.hit_id,this.listUsers.length>0&&this.listExpressions.length>0){if(this.listUsers[0]!=e.hit_id)return this.listUsers[0]=null,void c.alert("Data Perbandingan user tidak sama!");this.listExpressions[0]==this.expressions?this.urutanEkspresi=[]:this.message="Wajah Milik ".concat(e["name"],", \n Gunakan Ekspresi yang berbeda!!"),n.prosesAbsen(e,t)}this.$forceUpdate()},prosesAbsen:function(e,t){var n=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,i,s,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:window.checktimes.remove({},{multi:!0},(function(e,t){})),a=n,c.loadingOn(),i=document.getElementById("videoQRCODE"),s=document.createElement("canvas"),s.width=i.videoWidth,s.height=i.videoHeight,r=s.getContext("2d"),r.drawImage(i,0,0,s.width,s.height),o=s.toDataURL("image/png"),n.$store.state.checktimes.unshift({id_user:e.hit_id,name:e.name,checktime:a.formatTgl(new Date,"YYYY-MM-DD HH:mm:ss"),dataURL:o,work_location:e.work_location_id,lat:a.$store.state.lat,lng:a.$store.state.lng,type_location:a.$store.state.location,source_data:"local"}),window.checktimes.insert(n.$store.state.checktimes,(function(e,t){})),c.alert("Absen Berhasil","bg-blue-400"),c.loadingOff(),n.$router.push("/absen/checktime");case 15:case"end":return t.stop()}}),t)})))()},getImage:function(){var e=this,t=document.getElementById("videoQRCODE"),n=document.getElementById("canvas");n.width=t.videoWidth,n.height=t.videoHeight,n.getContext("2d").drawImage(t,0,0,t.videoWidth,t.videoHeight),n.toBlob((function(t){var n=new File([t],"photo.jpg",{type:"image/jpeg"});e.prosesAbsen(n)}),"image/jpeg")},getStream:function(e){var t=this;setTimeout((function(){var e=document.getElementById("videoQRCODE");console.log("video",e),navigator.mediaDevices.getUserMedia({video:{facingMode:t.$store.state.camera?"user":"environment",resizeMode:"true"}}).then((function(n){t.loading=!1,t.$forceUpdate(),e.srcObject=n,e.src=window.URL.createObjectURL(n),e.play()}))}),2e3)},getUserMedia:function(e){if(navigator.mediaDevices)return navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return t?new Promise((function(n,a){t.bind(navigator)(e,n,a)})):void 0},formatTgl:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD";return this.$datefns.format(new Date(e),t)}},mounted:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e;case 1:case"end":return t.stop()}}),t)})))()}},d=l,u=(n("31c1"),n("2877")),h=Object(u["a"])(d,a,i,!1,null,"599c0a1a",null);t["default"]=h.exports},c0b6:function(e,t,n){var a=n("23e7"),i=n("0538");a({target:"Function",proto:!0},{bind:i})},c60f:function(e,t,n){},cfc3:function(e,t,n){var a=n("74e8");a("Float32",(function(e){return function(t,n,a){return e(this,t,n,a)}}))},d81d:function(e,t,n){"use strict";var a=n("23e7"),i=n("b727").map,s=n("1dde"),r=s("map");a({target:"Array",proto:!0,forced:!r},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=page-absen-group_selfie.8aecf392.js.map