(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["page-register-wajah"],{"0212":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"py-4 px-2 shadow bg-blue-light text-white font-bold"},[a("div",{staticClass:"font-semibold text-xs mr-3 float-right mt-2"},[t._v(" Register Face ")]),a("div",{staticClass:"ml-2 cursor-pointer",on:{click:function(e){return t.$router.go(-1)}}},[a("svg",{staticClass:"d-inline mr-1",staticStyle:{fill:"white"},attrs:{width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"}},[a("path",{attrs:{d:"M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"}})])])]),a("div",{staticClass:"row justify-content-center bg-black",staticStyle:{height:"100vh"}},[a("div",{staticClass:"col-8 mt-4 text-center"},[a("img",{staticStyle:{height:"120px",width:"170px",display:"block",margin:"auto","border-radius":"20px"},attrs:{src:"",id:"outputImage",alt:"",onerror:"this.onerror=null;this.src='https://png.pngtree.com/png-vector/20190820/ourmid/pngtree-no-image-vector-illustration-isolated-png-image_1694547.jpg';"},on:{click:t.saveFace}}),a("div",{directives:[{name:"show",rawName:"v-show",value:t.simpanOutput,expression:"simpanOutput"}],staticClass:"mt-4"},[a("div",{staticClass:"sm-form"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.vdata["hit_id"],expression:"vdata['hit_id']"}],staticClass:"form-control p-2 rounded-lg shadow",attrs:{type:"hit_id",id:"hit_id",name:"hit_id",placeholder:"User ID"},domProps:{value:t.vdata["hit_id"]},on:{input:function(e){e.target.composing||t.$set(t.vdata,"hit_id",e.target.value)}}})]),a("div",{staticClass:"text-center"},[a("button",{staticClass:"mt-2 btn btn-sm btn-warning p-h-2 rounded-lg font-semibold btn-block text-lg",attrs:{type:"submit"},on:{click:t.saveFace}},[a("i",{staticClass:"fa-solid fa-face-smile"}),t._v(" Simpan "+t._s(t.descriptors.length)+" Wajah ")])])])]),a("div",{staticClass:"col-10 shadow rounded-lg p-3 my-2"},[a("div",[a("video",{staticClass:"border-2 border-white",staticStyle:{"border-radius":"20px"},attrs:{id:"video",height:"680",width:"512",autoplay:"",muted:""},domProps:{muted:!0},on:{click:t.zoomCamera}}),a("p",{staticClass:"text-white text-center"},[t._v("Register Your Face")])])])]),a("img",{staticStyle:{position:"absolute","z-index":"-10",top:"-10000px",width:"512px",height:"512px"},attrs:{src:"",id:"myimage",alt:""}}),a("div",{staticClass:"bg-transparent rounded-lg d-block d-sm-none",staticStyle:{position:"fixed",bottom:"-5px",left:"0px",width:"100vw",height:"60px","z-index":"100","border-top-left-radius":"20px","border-top-right-radius":"20px"}},[a("div",{staticClass:"row justify-content-center"},[a("div",{staticClass:"col-4 text-center p-3 cursor-pointer"}),a("div",{staticClass:"col-4 text-center p-3 cursor-pointer"},[a("div",{staticClass:"border-2 border-white d-inline p-4",staticStyle:{"border-radius":"50px"}},[a("svg",{staticClass:"mb-1",staticStyle:{fill:"rgb(246, 185, 31)",display:"inline"},attrs:{height:"20",width:"20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},on:{click:t.startScan}},[a("path",{attrs:{d:"M149.1 64.8L138.7 96H64C28.7 96 0 124.7 0 160V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V160c0-35.3-28.7-64-64-64H373.3L362.9 64.8C356.4 45.2 338.1 32 317.4 32H194.6c-20.7 0-39 13.2-45.5 32.8zM256 192a96 96 0 1 1 0 192 96 96 0 1 1 0-192z"}})])])]),a("div",{staticClass:"col-4 text-center p-3 cursor-pointer"})])])])},n=[],i=a("53ca"),o=a("1da1"),s=(a("96cf"),a("b0c0"),a("2b3d"),a("d3b7"),a("3ca3"),a("ddb0"),a("1276"),a("ac1f"),a("c19f"),a("ace4"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("d81d"),a("4160"),a("159b"),a("cfc3"),a("7db0"),a("4de4"),a("07ac"),a("e25e"),a("4795"),a("0d03"),a("75bf")),c=a("2f0b"),d=a("bc3a"),l=a.n(d),u=new c["a"]("ci","https://ebkm.my.id/"),p={data:function(){return{loop:!0,user:[],users:[],descriptor:[],descriptors:[],vdata:{},camera:"depan",loading:!0,lanjut:!1,showOutput:!1,simpanOutput:!1}},layout:"app",methods:{extractImage:function(){var t=document.getElementById("filenya"),e=t.files[0],a=new FileReader,r=document.getElementById("myimage");r.title=e.name,a.onload=function(t){r.src=t.target.result},a.readAsDataURL(e),this.startScan(r,!1)},startVideo:function(){var t=this,e=document.getElementById("video");navigator.mediaDevices.getUserMedia({video:{facingMode:t.$store.state.camera?"user":"environment",resizeMode:"true"}}).then((function(a){t.loading=!1,t.$forceUpdate(),e.srcObject=a,e.src=window.URL.createObjectURL(a),e.play()}))},dataURItoBlob:function(t){for(var e=atob(t.split(",")[1]),a=t.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(e.length),n=new Uint8Array(r),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return new Blob([r],{type:a})},startScan:function(t){var e=arguments,a=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var n,i,c,d,l,p,h,f,m;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return d=function(t,e){t.parentNode.insertBefore(e,t.nextSibling)},n=!(e.length>1&&void 0!==e[1])||e[1],u.alert("Extract Data Wajah","bg-blue-400"),i=a,n?(u.alert("video","bg-yellow-400"),c=document.getElementById("video"),t=c):(u.alert("Image","bg-yellow-400"),c=document.getElementById("myimage"),t=c),l=s["createCanvasFromMedia"](c),l.style.position="absolute;",d(document.getElementById("video"),l),p={width:c.width,height:c.height},u.alert("scanning ...","bg-green-400"),console.log(p),s["matchDimensions"](l,p),s["euclideanDistance"]([0,0],[0,20]),h=[1],r.next=16,Promise.all(h.map(function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(a){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log(a),!0,e.next=4,s["detectSingleFace"](t).withFaceLandmarks().withFaceDescriptor();case 4:if(f=e.sent,console.log(f),f){e.next=9;break}e.next=18;break;case 9:return i.extractFaceFromBox(t,f.detection.box),s["resizeResults"](f,p),l.getContext("2d").clearRect(0,0,l.width,l.height),console.log("draw box"),document.querySelectorAll("canvas").forEach((function(t,e){e>0&&t.remove()})),console.log(3),window.scrollTo({top:0,left:0,behavior:"smooth"}),r=[new Float32Array(f.descriptor)],e.abrupt("return",r);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 16:m=r.sent,i.tidakDikenali(m);case 18:case"end":return r.stop()}}),r)})))()},cekduplicate:function(t,e){var a=this;window.user_directory.find({},function(){var r=Object(o["a"])(regeneratorRuntime.mark((function r(n,i){var c,d,l,p,h;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!(i.length>0)){r.next=14;break}if(i=i.filter((function(t){if(t.facejson)return t})),!(i.length>0)){r.next=11;break}return r.next=5,Promise.all(i.map(function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.facejson){t.next=4;break}return a=[],e.facejson.forEach((function(t){a.push(new Float32Array(Object.values(t[0])))})),t.abrupt("return",new s["LabeledFaceDescriptors"](JSON.stringify({EMP_NO:e.EMP_NO,_id:e._id,FULL_NAME:e.FULL_NAME}),a));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 5:c=r.sent,d=parseInt(a.$store.state.akurasiWajah)/100,l=new s["FaceMatcher"](c,d),e&&(console.log("fullFaceDescription",e),p=l.findBestMatch(e.descriptor),console.log("results",p),"unknown"==p._label?t[0]&&a.tidakDikenali(t):(h=JSON.parse(p.label),console.log("user",p),console.log("user[0]",a.user),h.EMP_NO==a.user[0].EMP_NO?t[0]&&(u.alert("Wajah ini milik"+h.FULL_NAME+", tambahkan lagi?","bg-purple-400","top:80px;right:30px;"),a.lanjut=!0,a.simpanOutput=!0,a.descriptor=t,a.$forceUpdate()):(u.alert("Wajah ini mirip dengan ".concat(h.FULL_NAME),"bg-red-500","top:80px;right:30px;"),confirm("Wajah ini mirip dengan ".concat(h.FULL_NAME,", Yakin tambahkan di user baru?"))?a.tidakDikenali(t):(a.simpanOutput=!1,a.$forceUpdate())))),r.next=12;break;case 11:t[0]&&a.tidakDikenali(t);case 12:r.next=15;break;case 14:t[0]&&a.tidakDikenali(t);case 15:case"end":return r.stop()}}),r)})));return function(t,e){return r.apply(this,arguments)}}())},tidakDikenali:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:r=e,r.simpanOutput=!0,r.descriptor=t,t[0]?(r.descriptors.push(t[0]),u.alert("Total data Wajah : "+r.descriptors.length,"bg-dark","top:80px;right:30px;"),r.descriptors.length,r.$forceUpdate()):u.alert("Wajah tidak ditemukan coba lagi !");case 4:case"end":return a.stop()}}),a)})))()},extractFaceFromBox:function(t,e){var a=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var n,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=document.getElementById("outputImage"),a.showOutput=!0,a.$forceUpdate(),i=[new s["Rect"](e.x,e.y,e.width,e.height)],r.next=6,s["extractFaces"](t,i);case 6:o=r.sent,0==o.length?console.log("Face not found"):o.forEach((function(t){n.src=t.toDataURL()}));case 8:case"end":return r.stop()}}),r)})))()},saveFace:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var a,r,n,i,o,s,c,d,p,h,f;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(a=t,u.alert("Uploading Data Wajah","bg-blue-400"),u.loadingOn(),r=document.getElementById("video"),n=document.createElement("canvas"),n.width=r.videoWidth,n.height=r.videoHeight,i=n.getContext("2d"),i.drawImage(r,0,0,n.width,n.height),o=n.toDataURL("image/png"),s=atob(o.split(",")[1]),c=[],d=0;d<s.length;d++)c.push(s.charCodeAt(d));return p=new Blob([new Uint8Array(c)],{type:"image/png"}),h=new FormData,h.append("employee_id",t.vdata.hit_id),h.append("file",p),h.append("faces",JSON.stringify(t.descriptors)),window.employees.update({hit_id:a.$store.state.employee.hit_id},{$set:{faces:JSON.stringify(a.descriptors),source_data:"local"}},{multi:!0},(function(t,e){})),e.prev=19,e.next=22,l.a.post(t.$store.state.baseURL+"/api/hit/register-face",h);case 22:f=e.sent,console.log(f),alert("Update face success, please login again to update your data !"),a.$store.dispatch("update_employees"),setTimeout((function(){1==f.data&&t.$router.push("/login")}),1e3),e.next=32;break;case 29:e.prev=29,e.t0=e["catch"](19),t.$router.push("/main");case 32:u.loadingOff();case 33:case"end":return e.stop()}}),e,null,[[19,29]])})))()},zoomCamera:function(){document.querySelector("#video").classList.toggle("scale2")},format:function(t){return this.$datefns.format(new Date(t),"YYYYMMDDHHmmss")}},mounted:function(){var t=this;this.$store.state.hit_id&&(this.vdata.hit_id=this.$store.state.hit_id),"object"==("undefined"===typeof cordova?"undefined":Object(i["a"])(cordova))?document.addEventListener("deviceready",(function(){console.log("faceapi",s),t.startVideo()})):t.startVideo()}},h=p,f=a("2877"),m=Object(f["a"])(h,r,n,!1,null,null,null);e["default"]=m.exports},"07ac":function(t,e,a){var r=a("23e7"),n=a("6f53").values;r({target:"Object",stat:!0},{values:function(t){return n(t)}})},"0d03":function(t,e,a){var r=a("6eeb"),n=Date.prototype,i="Invalid Date",o="toString",s=n[o],c=n.getTime;new Date(NaN)+""!=i&&r(n,o,(function(){var t=c.call(this);return t===t?s.call(this):i}))},"53ca":function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0");function r(t){return r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}},"6f53":function(t,e,a){var r=a("83ab"),n=a("df75"),i=a("fc6a"),o=a("d1e7").f,s=function(t){return function(e){var a,s=i(e),c=n(s),d=c.length,l=0,u=[];while(d>l)a=c[l++],r&&!o.call(s,a)||u.push(t?[a,s[a]]:s[a]);return u}};t.exports={entries:s(!0),values:s(!1)}},c19f:function(t,e,a){"use strict";var r=a("23e7"),n=a("da84"),i=a("621a"),o=a("2626"),s="ArrayBuffer",c=i[s],d=n[s];r({global:!0,forced:d!==c},{ArrayBuffer:c}),o(s)},cfc3:function(t,e,a){var r=a("74e8");r("Float32",(function(t){return function(e,a,r){return t(this,e,a,r)}}))},d81d:function(t,e,a){"use strict";var r=a("23e7"),n=a("b727").map,i=a("1dde"),o=i("map");r({target:"Array",proto:!0,forced:!o},{map:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=page-register-wajah.dcd5bff0.js.map