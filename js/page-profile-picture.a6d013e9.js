(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["page-profile-picture"],{"07ac":function(e,t,a){var r=a("23e7"),n=a("6f53").values;r({target:"Object",stat:!0},{values:function(e){return n(e)}})},"0d03":function(e,t,a){var r=a("6eeb"),n=Date.prototype,i="Invalid Date",o="toString",c=n[o],s=n.getTime;new Date(NaN)+""!=i&&r(n,o,(function(){var e=s.call(this);return e===e?c.call(this):i}))},"53ca":function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));a("a4d3"),a("e01a"),a("d3b7"),a("d28b"),a("3ca3"),a("ddb0");function r(e){return r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}},"6f53":function(e,t,a){var r=a("83ab"),n=a("df75"),i=a("fc6a"),o=a("d1e7").f,c=function(e){return function(t){var a,c=i(t),s=n(c),u=s.length,d=0,l=[];while(u>d)a=s[d++],r&&!o.call(c,a)||l.push(e?[a,c[a]]:c[a]);return l}};e.exports={entries:c(!0),values:c(!1)}},c19f:function(e,t,a){"use strict";var r=a("23e7"),n=a("da84"),i=a("621a"),o=a("2626"),c="ArrayBuffer",s=i[c],u=n[c];r({global:!0,forced:u!==s},{ArrayBuffer:s}),o(c)},cfc3:function(e,t,a){var r=a("74e8");r("Float32",(function(e){return function(t,a,r){return e(this,t,a,r)}}))},d81d:function(e,t,a){"use strict";var r=a("23e7"),n=a("b727").map,i=a("1dde"),o=i("map");r({target:"Array",proto:!0,forced:!o},{map:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})},f31b:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"py-4 px-2 shadow bg-blue-light text-white font-bold"},[a("div",{staticClass:"font-semibold text-xs mr-3 float-right mt-2"},[e._v(" Profile Picture ")]),a("div",{staticClass:"ml-2 cursor-pointer",on:{click:function(t){return e.$router.go(-1)}}},[a("svg",{staticClass:"d-inline mr-1",staticStyle:{fill:"white"},attrs:{width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"}},[a("path",{attrs:{d:"M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"}})])])]),a("div",{staticClass:"row justify-content-center bg-black",staticStyle:{height:"100vh"}},[a("div",{staticClass:"col-10 shadow rounded-lg p-3 my-2"},[a("div",[a("video",{staticClass:"border-2 border-white",staticStyle:{"border-radius":"20px"},attrs:{id:"video",height:"680",width:"512",autoplay:"",muted:""},domProps:{muted:!0},on:{click:e.zoomCamera}}),a("p",{staticClass:"text-white text-center"},[e._v("Take Your Profile Picture")])])])]),a("img",{staticStyle:{position:"absolute","z-index":"-10",top:"-10000px",width:"512px",height:"512px"},attrs:{src:"",id:"myimage",alt:""}}),a("div",{staticClass:"bg-transparent rounded-lg d-block d-sm-none",staticStyle:{position:"fixed",bottom:"-5px",left:"0px",width:"100vw",height:"60px","z-index":"100","border-top-left-radius":"20px","border-top-right-radius":"20px"}},[a("div",{staticClass:"row justify-content-center"},[a("div",{staticClass:"col-4 text-center p-3 cursor-pointer"}),a("div",{staticClass:"col-4 text-center p-3 cursor-pointer"},[a("div",{staticClass:"border-2 border-white d-inline p-4",staticStyle:{"border-radius":"50px"}},[a("svg",{staticClass:"mb-1",staticStyle:{fill:"rgb(246, 185, 31)",display:"inline"},attrs:{height:"20",width:"20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},on:{click:e.saveFace}},[a("path",{attrs:{d:"M149.1 64.8L138.7 96H64C28.7 96 0 124.7 0 160V416c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V160c0-35.3-28.7-64-64-64H373.3L362.9 64.8C356.4 45.2 338.1 32 317.4 32H194.6c-20.7 0-39 13.2-45.5 32.8zM256 192a96 96 0 1 1 0 192 96 96 0 1 1 0-192z"}})])])]),a("div",{staticClass:"col-4 text-center p-3 cursor-pointer"})])])])},n=[],i=a("53ca"),o=a("1da1"),c=(a("96cf"),a("b0c0"),a("2b3d"),a("d3b7"),a("3ca3"),a("ddb0"),a("1276"),a("ac1f"),a("c19f"),a("ace4"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("d81d"),a("4160"),a("159b"),a("cfc3"),a("7db0"),a("4de4"),a("07ac"),a("e25e"),a("4795"),a("0d03"),a("75bf")),s=a("2f0b"),u=a("bc3a"),d=a.n(u),l=new s["a"]("ci","https://ebkm.my.id/"),p={data:function(){return{loop:!0,user:[],users:[],descriptor:[],descriptors:[],vdata:{},camera:"depan",loading:!0,lanjut:!1,showOutput:!1,simpanOutput:!1}},layout:"app",methods:{extractImage:function(){var e=document.getElementById("filenya"),t=e.files[0],a=new FileReader,r=document.getElementById("myimage");r.title=t.name,a.onload=function(e){r.src=e.target.result},a.readAsDataURL(t),this.startScan(r,!1)},startVideo:function(){var e=this,t=document.getElementById("video");navigator.mediaDevices.getUserMedia({video:{facingMode:e.$store.state.camera?"user":"environment",resizeMode:"true"}}).then((function(a){e.loading=!1,e.$forceUpdate(),t.srcObject=a,t.src=window.URL.createObjectURL(a),t.play()}))},dataURItoBlob:function(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),n=new Uint8Array(r),i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return new Blob([r],{type:a})},startScan:function(e){var t=arguments,a=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var n,i,s,u,d,p,f,h,m;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return u=function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},n=!(t.length>1&&void 0!==t[1])||t[1],l.alert("Extract Data Wajah","bg-blue-400"),i=a,n?(l.alert("video","bg-yellow-400"),s=document.getElementById("video"),e=s):(l.alert("Image","bg-yellow-400"),s=document.getElementById("myimage"),e=s),d=c["createCanvasFromMedia"](s),d.style.position="absolute;",u(document.getElementById("video"),d),p={width:s.width,height:s.height},l.alert("scanning ...","bg-green-400"),console.log(p),c["matchDimensions"](d,p),c["euclideanDistance"]([0,0],[0,20]),f=[1],r.next=16,Promise.all(f.map(function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(a){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(a),!0,t.next=4,c["detectSingleFace"](e).withFaceLandmarks().withFaceDescriptor();case 4:if(h=t.sent,console.log(h),h){t.next=9;break}t.next=18;break;case 9:return i.extractFaceFromBox(e,h.detection.box),c["resizeResults"](h,p),d.getContext("2d").clearRect(0,0,d.width,d.height),console.log("draw box"),document.querySelectorAll("canvas").forEach((function(e,t){t>0&&e.remove()})),console.log(3),window.scrollTo({top:0,left:0,behavior:"smooth"}),r=[new Float32Array(h.descriptor)],t.abrupt("return",r);case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 16:m=r.sent,i.tidakDikenali(m);case 18:case"end":return r.stop()}}),r)})))()},cekduplicate:function(e,t){var a=this;window.user_directory.find({},function(){var r=Object(o["a"])(regeneratorRuntime.mark((function r(n,i){var s,u,d,p,f;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!(i.length>0)){r.next=14;break}if(i=i.filter((function(e){if(e.facejson)return e})),!(i.length>0)){r.next=11;break}return r.next=5,Promise.all(i.map(function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.facejson){e.next=4;break}return a=[],t.facejson.forEach((function(e){a.push(new Float32Array(Object.values(e[0])))})),e.abrupt("return",new c["LabeledFaceDescriptors"](JSON.stringify({EMP_NO:t.EMP_NO,_id:t._id,FULL_NAME:t.FULL_NAME}),a));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:s=r.sent,u=parseInt(a.$store.state.akurasiWajah)/100,d=new c["FaceMatcher"](s,u),t&&(console.log("fullFaceDescription",t),p=d.findBestMatch(t.descriptor),console.log("results",p),"unknown"==p._label?e[0]&&a.tidakDikenali(e):(f=JSON.parse(p.label),console.log("user",p),console.log("user[0]",a.user),f.EMP_NO==a.user[0].EMP_NO?e[0]&&(l.alert("Wajah ini milik"+f.FULL_NAME+", tambahkan lagi?","bg-purple-400","top:80px;right:30px;"),a.lanjut=!0,a.simpanOutput=!0,a.descriptor=e,a.$forceUpdate()):(l.alert("Wajah ini mirip dengan ".concat(f.FULL_NAME),"bg-red-500","top:80px;right:30px;"),confirm("Wajah ini mirip dengan ".concat(f.FULL_NAME,", Yakin tambahkan di user baru?"))?a.tidakDikenali(e):(a.simpanOutput=!1,a.$forceUpdate())))),r.next=12;break;case 11:e[0]&&a.tidakDikenali(e);case 12:r.next=15;break;case 14:e[0]&&a.tidakDikenali(e);case 15:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())},tidakDikenali:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:r=t,r.simpanOutput=!0,r.descriptor=e,e[0]?(r.descriptors.push(e[0]),l.alert("Total data Wajah : "+r.descriptors.length,"bg-dark","top:80px;right:30px;"),r.descriptors.length,r.$forceUpdate()):l.alert("Wajah tidak ditemukan coba lagi !");case 4:case"end":return a.stop()}}),a)})))()},extractFaceFromBox:function(e,t){var a=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var n,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=document.getElementById("outputImage"),a.showOutput=!0,a.$forceUpdate(),i=[new c["Rect"](t.x,t.y,t.width,t.height)],r.next=6,c["extractFaces"](e,i);case 6:o=r.sent,0==o.length?console.log("Face not found"):o.forEach((function(e){n.src=e.toDataURL()}));case 8:case"end":return r.stop()}}),r)})))()},saveFace:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,r,n,i,o,c,s,u,p,f,h;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(a=e,l.alert("Uploading Data Wajah","bg-blue-400"),l.loadingOn(),r=document.getElementById("video"),n=document.createElement("canvas"),n.width=r.videoWidth,n.height=r.videoHeight,i=n.getContext("2d"),i.drawImage(r,0,0,n.width,n.height),o=n.toDataURL("image/png"),c=atob(o.split(",")[1]),s=[],u=0;u<c.length;u++)s.push(c.charCodeAt(u));return p=new Blob([new Uint8Array(s)],{type:"image/png"}),f=new FormData,f.append("employee_id",e.vdata.hit_id),f.append("file",p),f.append("faces",[]),window.employees.update({hit_id:a.$store.state.employee.hit_id},{$set:{faces:JSON.stringify(a.descriptors),source_data:"local"}},{multi:!0},(function(e,t){})),t.prev=19,t.next=22,d.a.post(e.$store.state.baseURL+"/api/hit/profile-picture",f);case 22:h=t.sent,alert("Update face success, please login again to update your data !"),a.$store.dispatch("update_employees"),setTimeout((function(){1==h.data&&e.$router.push("/login")}),1e3),t.next=31;break;case 28:t.prev=28,t.t0=t["catch"](19),e.$router.push("/main");case 31:l.loadingOff();case 32:case"end":return t.stop()}}),t,null,[[19,28]])})))()},zoomCamera:function(){document.querySelector("#video").classList.toggle("scale2")},format:function(e){return this.$datefns.format(new Date(e),"YYYYMMDDHHmmss")}},mounted:function(){var e=this;this.$store.state.hit_id&&(this.vdata.hit_id=this.$store.state.hit_id),"object"==("undefined"===typeof cordova?"undefined":Object(i["a"])(cordova))?document.addEventListener("deviceready",(function(){console.log("faceapi",c),e.startVideo()})):e.startVideo()}},f=p,h=a("2877"),m=Object(h["a"])(f,r,n,!1,null,null,null);t["default"]=m.exports}}]);
//# sourceMappingURL=page-profile-picture.a6d013e9.js.map